<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ReVive - Vendas e Cultura</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- ESTILOS GERAIS --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%); min-height: 100vh; color: #333; overflow-x: hidden; }
        .main-container { max-width: 1820px; margin: 0 auto; padding: 26px; }
        .header { text-align: center; margin-bottom: 39px; background: white; padding: 33px; border-radius: 26px; box-shadow: 0 10px 42px rgba(147, 51, 234, 0.1); border: 1px solid rgba(147, 51, 234, 0.1); position: relative; overflow: hidden; }
        .header::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 7px; background: linear-gradient(90deg, #8b5cf6, #6b46c1, #a78bfa); }
        .header h1 { color: #6b46c1; font-size: 3.25rem; font-weight: 700; margin-bottom: 13px; display: flex; align-items: center; justify-content: center; gap: 20px; }
        .header h1 i { background: linear-gradient(135deg, #8b5cf6, #6b46c1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header .subtitle { color: #8b5cf6; font-size: 1.4rem; opacity: 0.8; }

        /* --- ESTILOS DO DASHBOARD --- */
        .connection-status { margin: 20px auto; padding: 13px 20px; border-radius: 13px; font-size: 1.2rem; font-weight: 500; display: inline-flex; align-items: center; gap: 13px; max-width: 390px; }
        .status-connected { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
        .status-error { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }
        .status-loading { background: #fef3c7; color: #92400e; border: 1px solid #f59e0b; }
        .stats-grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Cria as duas colunas principais */
            gap: 26px;
            margin-bottom: 39px;
        }
        
        .stats-column {
            display: flex;
            flex-direction: column; /* Empilha os cards verticalmente dentro de cada coluna */
            gap: 26px;
        }
        .stat-card { background: white; padding: 33px; border-radius: 20px; box-shadow: 0 10px 42px rgba(147, 51, 234, 0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; position: relative; overflow: hidden; }
        .stat-card h3 { color: #6b46c1; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1.3px; margin-bottom: 13px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .stat-card-ce h3 { 
            color: #10b981 !important; 
        }
        .stat-card-ce .stat-value { 
            color: #10b981 !important; 
        }
        .stat-card-ce .stat-label { 
            color: #34d399 !important; 
        }
        .stat-value { font-size: 2.2rem; font-weight: 700; color: #8b5cf6; display: flex; align-items: center; gap: 20px; }
        .stat-label { color: #a78bfa; font-size: 1rem; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 39px; margin-bottom: 39px; }
        .rankings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 26px; margin-bottom: 26px; }
        .panel { background: white; border-radius: 26px; padding: 33px; box-shadow: 0 10px 42px rgba(147, 51, 234, 0.1); }
        .panel.full-width { grid-column: 1 / -1; }
        .panel-sc { border-top: 4px solid #8b5cf6; }
        .panel-ce { border-top: 4px solid #10b981; }
        .panel h2 { color: #6b46c1; font-size: 2rem; margin-bottom: 26px; font-weight: 600; padding-bottom: 13px; border-bottom: 3px solid #f3f4f6; display: flex; align-items: center; gap: 13px; }
        .panel-ce h2 { color: #10b981; }
        .ranking-item { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid #f3f4f6; }
        .ranking-item:last-child { border-bottom: none; }
        /* --- ESTILOS PARA O RANKING EXPANS√çVEL --- */
        .ranking-list-container {
            transition: max-height 0.7s ease-in-out;
            overflow: hidden;
        }

        .ranking-list-container.collapsed {
            /* Ajuste este valor se a altura dos 5 primeiros itens for diferente */
            max-height: 400px; 
        }

        .expand-ranking-btn {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid #e8ecff;
            background-color: #f8f9ff;
            color: #6b46c1;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .expand-ranking-btn:hover {
            background-color: #e8ecff;
            border-color: #dadaff;
        }

        .expand-ranking-btn.btn-ce {
            color: #10b981;
            border-color: #d1fae5;
            background-color: #f0fdf4;
        }

        .expand-ranking-btn.btn-ce:hover {
            background-color: #d1fae5;
            border-color: #a7f3d0;
        }
        .consultant-info { display: flex; align-items: center; gap: 20px; }
        .rank-number { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; width: 39px; height: 39px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.2rem; flex-shrink: 0; }
        .rank-number-ce { background: linear-gradient(135deg, #10b981, #34d399); }
        .consultant-name { color: #374151; font-weight: 500; font-size: 1.2rem; }
        .sales-count { background: #e8ecff; color: #6b46c1; padding: 7px 16px; border-radius: 26px; font-weight: 600; font-size: 1.2rem; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .sales-count:hover { background-color: #6b46c1; color: white; }
        .two-column-layout { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 39px; 
            margin-bottom: 39px; 
        }
        
        .sales-table th.th-ce { 
            background: linear-gradient(135deg, #10b981, #34d399); 
        }
        .consultant-photo-ranking { width: 52px; height: 52px; border-radius: 50%; object-fit: cover; border: 3px solid #e8ecff; }
        #topConsultantPhoto { width: 104px; height: 104px; border-radius: 50%; object-fit: cover; border: 5px solid #a78bfa; margin-left: 20px; box-shadow: 0 7px 20px rgba(147, 51, 234, 0.25); background-color: #f0f2ff; transition: transform 0.3s ease; }
        .stat-card:hover #topConsultantPhoto { transform: scale(1.05); }
        #topConsultantPhotoCE { 
            width: 104px; 
            height: 104px; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 5px solid #10b981; 
            margin-left: 20px; 
            box-shadow: 0 7px 20px rgba(16, 185, 129, 0.25); 
            background-color: #10b981; 
            transition: transform 0.3s ease; 
        }
        .stat-card:hover #topConsultantPhotoCE { 
            transform: scale(1.05); 
        }
        .process-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
        .process-card { background: linear-gradient(135deg, #f8f9ff, #e8ecff); padding: 26px; border-radius: 20px; text-align: center; }
        .process-card h4 { color: #6b46c1; font-size: 1.2rem; margin-bottom: 13px; text-transform: uppercase; }
        .process-number { font-size: 2.6rem; font-weight: 700; color: #8b5cf6; }
        .process-meta { font-size: 1rem; color: #6b7280; margin-top: 7px; }
        .recent-sales { grid-column: 1 / -1; }


        
        .sales-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 1.2rem; }
        .sales-table th { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; padding: 20px; text-align: left; font-weight: 700; }
        .sales-table td { padding: 20px; border-bottom: 1px solid #f3f4f6; color: #374151; vertical-align: middle; }
        .sales-table tr:nth-child(even) { background-color: #f9fafb; }
        .process-badge, .date-badge, .status-badge { padding: 8px 16px; border-radius: 26px; font-size: 1rem; display: inline-block; font-weight: 500; }
        .process-badge { background: #e8ecff; color: #6b46c1; }
        .date-badge { background: #f3f4f6; color: #6b7280; }
        .status-badge { color: white; }
        
        .month-selector { background: white; padding: 15px; border-radius: 20px; margin-bottom: 26px; box-shadow: 0 5px 16px rgba(0, 0, 0, 0.05); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px; }
        .month-selector-group { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .month-selector label { font-weight: 600; color: #6b46c1; font-size: 1.2rem; }
        .month-selector select { padding: 10px 20px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 1.2rem; background-color: white; cursor: pointer; }
        
        .carousel-controls-group { display: flex; align-items: center; gap: 10px; }
        #carousel-toggle-button, .carousel-nav-btn { padding: 10px 16px; border: 1px solid #d1d5db; border-radius: 10px; background-color: white; color: #6b46c1; cursor: pointer; font-size: 1.2rem; transition: background-color 0.2s, color 0.2s; line-height: 1; }
        #carousel-toggle-button:hover, .carousel-nav-btn:hover { background-color: #f3f4f6; }
        #carousel-nav-controls { display: flex; gap: 10px; }
        
        .carousel-page { display: none; opacity: 0; animation: fadeIn 0.8s ease-in-out forwards; }
        .carousel-page.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }
        
        .culture-section { margin-top: 39px; display: flex; flex-direction: column; gap: 39px; }
        .mission-vision-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 39px; }
        .culture-card { background: white; padding: 45px; border-radius: 26px; box-shadow: 0 10px 42px rgba(147, 51, 234, 0.1); text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; justify-content: center; }
        .culture-card:hover { transform: translateY(-10px); box-shadow: 0 16px 52px rgba(147, 51, 234, 0.15); }

        .prominent-card { background: linear-gradient(135deg, #fdfcff, #f3f5ff); border-top: 7px solid #8b5cf6; }
        .prominent-card .icon { font-size: 4.5rem; margin-bottom: 33px; background: linear-gradient(135deg, #8b5cf6, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .prominent-card h2 { font-size: 2.8rem; color: #6b46c1; margin-bottom: 26px; }
        .prominent-card p { font-size: 1.8rem; font-weight: 500; color: #374151; line-height: 1.5; }

        #values-card { border-top: 7px solid #a78bfa; }
        #values-card .icon { font-size: 3.9rem; background: linear-gradient(135deg, #8b5cf6, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 26px; }
        #values-card h2 { font-size: 2.3rem; color: #6b46c1; margin-bottom: 20px; }
        .values-inline-list { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px; margin-top: 33px; }
        .value-tag { background: #f8f9ff; padding: 16px 26px; border-radius: 39px; border: 1px solid #e8ecff; color: #6b46c1; font-weight: 600; font-size: 1.6rem; display: inline-flex; align-items: center; gap: 13px; transition: all 0.3s ease; }
        .value-tag:hover { transform: translateY(-4px); box-shadow: 0 5px 20px rgba(147, 51, 234, 0.1); border-color: #dadaff; }
        .value-tag i { font-size: 1.8rem; opacity: 0.8; }

        .process-counter-container { margin-top: 26px; padding-top: 26px; border-top: 2px solid #e8ecff; }
        .process-counter-container h3 { color: #6b46c1; font-size: 1.8rem; font-weight: 600; margin-bottom: 13px; text-transform: uppercase; letter-spacing: 1px; }
        .process-counter { font-size: 3rem; font-weight: 700; color: #8b5cf6; }
        .process-counter span { background: linear-gradient(135deg, #8b5cf6, #6b46c1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .timeline { position: relative; max-width: 1040px; margin: 65px auto; padding: 26px 0; }
        .timeline::before { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: linear-gradient(to bottom, #a78bfa, #8b5cf6); border-radius: 4px; transform: translateX(-50%); }
        .timeline-item { padding: 13px 52px; position: relative; width: 50%; }
        .timeline-item:nth-child(odd) { left: 0; text-align: right; }
        .timeline-item:nth-child(even) { left: 50%; text-align: left; }
        .timeline-item .content { background: white; padding: 33px; border-radius: 20px; box-shadow: 0 10px 42px rgba(147, 51, 234, 0.1); position: relative; }
        .timeline-item .date { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; padding: 10px 20px; border-radius: 26px; font-weight: 600; display: inline-block; margin-bottom: 13px; font-size: 1.1rem; }
        .timeline-item h3 { font-size: 1.8rem; color: #6b46c1; margin-bottom: 10px; }
        .timeline-item p { font-size: 1.3rem; color: #555; }
        .timeline-item::after { content: ''; position: absolute; width: 26px; height: 26px; background: white; border: 5px solid #8b5cf6; border-radius: 50%; top: 33px; z-index: 1; }
        .timeline-item:nth-child(odd)::after { right: -13px; }
        .timeline-item:nth-child(even)::after { left: -13px; }
        
        #sale-notification-overlay { 
            position: fixed !important; 
            top: 0 !important; 
            left: 0 !important; 
            width: 100% !important; 
            height: 100% !important; 
            background: rgba(29, 13, 51, 0.7) !important; 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px); 
            z-index: 999999 !important; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            opacity: 0; 
            transition: opacity 0.5s ease; 
            overflow: hidden; 
        }
        #sale-notification-overlay.show { 
            display: flex !important; 
            opacity: 1 !important; 
        }
        .notification-content { background: white; padding: 52px 65px; border-radius: 33px; text-align: center; box-shadow: 0 26px 65px rgba(0,0,0,0.3); position: relative; transform: scale(0.7); opacity: 0; animation: pop-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; max-width: 90%; width: 910px; border-top: 10px solid #a78bfa; }
        @keyframes pop-in { to { transform: scale(1); opacity: 1; } }
        
        .notification-photo { width: 130px; height: 130px; border-radius: 50%; object-fit: cover; border: 5px solid #a78bfa; margin-bottom: 26px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .notification-content .main-icon { font-size: 5.2rem; color: #ffc107; text-shadow: 0 5px 13px rgba(255, 193, 7, 0.5); margin-bottom: 26px; }
        .notification-content h2 { font-size: 3.6rem; font-weight: 800; color: #6b46c1; margin-bottom: 20px; }
        .notification-content p { font-size: 1.7rem; color: #555; line-height: 1.6; }
        .notification-content p strong { color: #8b5cf6; font-weight: 700; }
        .notification-content .process-info { font-size: 1.3rem; color: #777; margin-top: 13px; background: #f8f9ff; padding: 10px 20px; border-radius: 13px; display: inline-block; border: 1px solid #e8ecff; }
        
        .animation-extras { position: absolute; bottom: -65px; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .rocket, .money-symbol, .clapping-hands { position: absolute; font-size: 2.6rem; opacity: 0; }
        .rocket { color: #8b5cf6; animation: launch 3s ease-in forwards; }
        @keyframes launch { 0% { transform: translateY(0) rotate(-45deg); opacity: 1; } 100% { transform: translateY(-120vh) rotate(-45deg); opacity: 0; } }
        .rocket:nth-child(1) { left: 15%; animation-delay: 0.1s; }
        .rocket:nth-child(2) { left: 80%; animation-delay: 0.5s; }
        .rocket:nth-child(3) { left: 50%; animation-delay: 0.2s; }
        
        .money-symbol { color: #22c55e; animation: float-up 4s ease-out forwards; }
        .clapping-hands { color: #ffc107; animation: float-up 4s ease-out forwards; }
        @keyframes float-up { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; } }
        .money-symbol:nth-child(1), .clapping-hands:nth-child(1) { left: 20%; font-size: 3rem; animation-delay: 0.1s; }
        .money-symbol:nth-child(2), .clapping-hands:nth-child(2) { left: 75%; font-size: 2.5rem; animation-delay: 0.8s; }
        .money-symbol:nth-child(3), .clapping-hands:nth-child(3) { left: 45%; font-size: 3.5rem; animation-delay: 0.4s; }

        #process-details-modal { position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 39px; border: 1px solid #888; width: 90%; max-width: 650px; border-radius: 20px; box-shadow: 0 7px 33px rgba(0,0,0,0.2); position: relative; animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal-content h2 { color: #6b46c1; margin-top: 0; margin-bottom: 26px; border-bottom: 3px solid #f3f4f6; padding-bottom: 20px; font-size: 2rem; }
        .close-button { color: #aaa; position: absolute; top: 20px; right: 33px; font-size: 36px; font-weight: bold; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }
        .details-list { list-style-type: none; padding: 0; max-height: 390px; overflow-y: auto; }
        .details-list li { padding: 13px 7px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-size: 1.25rem; }
        .details-list li:last-child { border-bottom: none; }
        .details-list .process-name { color: #374151; }
        .details-list .process-count-badge { background: #8b5cf6; color: white; padding: 5px 13px; border-radius: 20px; font-weight: 600; font-size: 1.1rem; }
        
        .payment-filter-container { display: flex; gap: 10px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid #f3f4f6; flex-wrap: wrap; }
        .payment-filter-btn { padding: 10px 20px; cursor: pointer; border: 1px solid #d1d5db; background-color: #f9fafb; font-size: 1.1rem; font-weight: 600; color: #6b7280; border-radius: 20px; transition: color 0.3s, background-color 0.3s, border-color 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .payment-filter-btn:hover { background-color: #e8ecff; color: #6b46c1; }
        .payment-filter-btn.active { background-color: #8b5cf6; color: white; border-color: #8b5cf6; }
        .payment-status-section { display: block; animation: fadeIn 0.5s; }
        .payment-status-section h2 { border-bottom: none; padding-bottom: 0; margin-bottom: 15px; margin-top: 25px; justify-content: flex-start; }
        .payment-status-section:first-of-type h2 { margin-top: 0; }

        @media (max-width: 1024px) {
            .stats-grid-container {
                grid-template-columns: 1fr; /* Faz as colunas empilharem em telas menores */
            }
            
            .timeline::before { left: 20px; }
            .timeline-item { width: 100%; padding-left: 65px; padding-right: 13px; }
            .timeline-item:nth-child(odd), .timeline-item:nth-child(even) { left: 0; text-align: left; }
            .timeline-item:nth-child(odd)::after, .timeline-item:nth-child(even)::after { left: 7px; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- P√°ginas do Carrossel -->
        <!-- SUBSTITUA ESTE BLOCO INTEIRO -->
        <div id="dashboard-view" class="carousel-page active" data-name="Dashboard">
            <div class="header"><h1><i class="fas fa-chart-line"></i> Dashboard de Vendas - ReVive</h1><p class="subtitle">Rumo aos cem mil processos at√© 2030!</p></div>
            <div class="connection-status" id="connectionStatus" style="margin: 0 auto 20px auto;"><i class="fas fa-sync fa-spin"></i><span id="statusText">Verificando conex√£o...</span></div>
            <div class="month-selector">
                <div class="month-selector-group">
                    <label for="monthFilter"><i class="fas fa-calendar"></i> M√™s:</label>
                    <select id="monthFilter" onchange="updateDashboard()"></select>
                </div>
                <div class="month-selector-group">
                    <label for="pageSelector"><i class="fas fa-map-signs"></i> Navegar para:</label>
                    <select id="pageSelector" onchange="jumpToPage(this.value)"></select>
                </div>
                <div class="carousel-controls-group">
                    <div id="carousel-nav-controls">
                        <button class="carousel-nav-btn" title="P√°gina Anterior" onclick="manualNavigate(-1)"><i class="fas fa-chevron-left"></i></button>
                        <button class="carousel-nav-btn" title="Pr√≥xima P√°gina" onclick="manualNavigate(1)"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <button id="carousel-toggle-button" title="Pausar Carrossel"><i class="fas fa-pause"></i></button>
                </div>
            </div>
            
<!-- CARD DE TOTAL GLOBAL (NOVO) -->
            <div class="stat-card" style="margin-bottom: 26px; text-align: center; border-top: 4px solid #6b46c1;">
                <h3><i class="fas fa-globe"></i> Total Processos (Empresa)</h3>
                <div class="stat-value" id="totalMonthGlobal" style="justify-content: center;">-</div>
                <div class="stat-label" id="monthLabelGlobal">-</div>
            </div>

            <div class="stats-grid-container">
                <!-- Coluna da Esquerda: Santa Catarina -->
                <div class="stats-column">
                    <!-- CARD DE SC (MODIFICADO) -->
                    <div class="stat-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Total Processos (SC)</h3>
                        <div class="stat-value" id="totalMonthSC">-</div>
                        <div class="stat-label" id="monthLabelSC">-</div>
                    </div>
                    <div class="stat-card">
                        <h3><i class="fas fa-chart-bar"></i> M√©dia Di√°ria (SC)</h3>
                        <div class="stat-value" id="dailyAverageSC">-</div>
                        <div class="stat-label">processos/dia em SC</div>
                    </div>
                    <div class="stat-card">
                        <h3><i class="fas fa-trophy"></i> Melhor Consultor SC</h3>
                        <div class="stat-value">üèÜ <span id="topConsultant">-</span><img id="topConsultantPhoto" src="" alt="Foto do Melhor Consultor SC" style="display: none;"></div>
                        <div class="stat-label">em processos este m√™s</div>
                    </div>
                </div>
            
                <!-- Coluna da Direita: Cear√° -->
                <div class="stats-column">
                    <div class="stat-card stat-card-ce">
                        <h3><i class="fas fa-sun"></i> Total Processos (Cear√°)</h3>
                        <div class="stat-value" id="totalMonthCE">-</div>
                        <div class="stat-label">processos no Cear√°</div>
                    </div>
                    <div class="stat-card stat-card-ce">
                        <h3><i class="fas fa-chart-bar"></i> M√©dia Di√°ria (CE)</h3>
                        <div class="stat-value" id="dailyAverageCE">-</div>
                        <div class="stat-label">processos/dia no Cear√°</div>
                    </div>
                    <div class="stat-card stat-card-ce">
                        <h3><i class="fas fa-trophy"></i> Melhor Consultor CE</h3>
                        <div class="stat-value">üèÜ <span id="topConsultantCE">-</span><img id="topConsultantPhotoCE" src="" alt="Foto do Melhor Consultor CE" style="display: none;"></div>
                        <div class="stat-label">em processos este m√™s</div>
                    </div>
                </div>
            </div>
            
            <!-- PAINEL DE METAS RESTAURADO -->
            <div class="panel full-width" style="margin-bottom: 39px;">
                <h2><i class="fas fa-chart-pie"></i> Tipos de Processo e Metas</h2>
                <div class="process-stats">
                    <div class="process-card"><h4>Previdenci√°rios</h4><div class="process-number" id="previdenciariosCount">-</div><div class="process-meta">Meta: <span id="previdenciariosGoal">-</span> (<span id="previdenciariosPercent">-</span>%)</div></div>
                    <div class="process-card"><h4>Seguro Terceiro</h4><div class="process-number" id="seguroTerceiroCount">-</div><div class="process-meta">Meta: <span id="seguroTerceiroGoal">-</span> (<span id="seguroTerceiroPercent">-</span>%)</div></div>
                    <div class="process-card"><h4>Seguro de Vida</h4><div class="process-number" id="seguroVidaCount">-</div><div class="process-meta">Meta: <span id="seguroVidaGoal">-</span> (<span id="seguroVidaPercent">-</span>%)</div></div>
                    <div class="process-card"><h4>Outros</h4><div class="process-number" id="outrosCount">-</div></div>
                </div>
            </div>
            <!-- PAINEL DE RANKINGS (RESTAURAR ESTE BLOCO) -->
            <div class="rankings-grid" style="margin-bottom: 39px;">
                <!-- Ranking de Santa Catarina -->
                <div class="panel panel-sc">
                    <h2><i class="fas fa-medal"></i> Ranking de Consultores (SC)</h2>
                    <div id="consultantRanking">
                        <!-- O JavaScript vai preencher este espa√ßo -->
                    </div>
                </div>
                <!-- Ranking do Cear√° -->
                <div class="panel panel-ce">
                    <h2><i class="fas fa-medal"></i> Ranking de Consultores (CE)</h2>
                    <div id="cearaRanking">
                        <!-- O JavaScript vai preencher este espa√ßo -->
                    </div>
                </div>
            </div>
            <div class="two-column-layout">
                <!-- Coluna da Esquerda: Lista de Processos SC -->
                <div class="panel panel-sc">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 10px;">
                        <h2 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;"><i class="fas fa-clock"></i> Processos do M√™s (SC)</h2>
                        <div class="consultant-filter-container">
                            <label for="consultantFilter" style="font-weight: 600; color: #6b46c1; margin-right: 10px; font-size: 1.2rem;">Filtrar:</label>
                            <select id="consultantFilter" onchange="filterSalesByConsultant()" style="padding: 10px 20px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 1.2rem; background-color: white; cursor: pointer;"></select>
                        </div>
                    </div>
                    <table class="sales-table" style="font-size: 1.2rem;">
                        <thead>
                            <tr><th>Data</th><th>Cliente</th><th>Processo</th><th>Consultor</th></tr>
                        </thead>
                        <tbody id="recentSalesTable"></tbody>
                    </table>
                </div>
                <!-- Coluna da Direita: Lista de Processos CE -->
                <div class="panel panel-ce">
                     <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 10px;">
                        <h2 style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;"><i class="fas fa-clock"></i> Processos do M√™s (CE)</h2>
                        <div class="consultant-filter-container">
                            <label for="consultantFilterCE" style="font-weight: 600; color: #10b981; margin-right: 10px; font-size: 1.2rem;">Filtrar:</label>
                            <select id="consultantFilterCE" onchange="filterSalesByConsultantCE()" style="padding: 10px 20px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 1.2rem; background-color: white; cursor: pointer;"></select>
                        </div>
                    </div>
                    <table class="sales-table" style="font-size: 1.2rem;">
                        <thead>
                            <tr><th class="th-ce">Data</th><th class="th-ce">Cliente</th><th class="th-ce">Processo</th><th class="th-ce">Consultor</th></tr>
                        </thead>
                        <tbody id="recentSalesTableCE"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="chart-view" class="carousel-page" data-name="Gr√°ficos"><div class="header"><h1><i class="fas fa-chart-area"></i> Evolu√ß√£o de Processos</h1><p class="subtitle" id="chart-subtitle">Acompanhamento mensal do ano corrente</p></div><div class="panel"><div style="position: relative; height: 585px;"><canvas id="processEvolutionChart"></canvas></div></div></div>
        
        <div id="mission-view" class="carousel-page" data-name="Cultura">
            <div class="header">
                <h1><i class="fas fa-gem"></i> Nossa Cultura - ReVive</h1>
                <p class="subtitle">Os pilares que nos guiam todos os dias.</p>
            </div>
            <div class="culture-section">
                <div class="mission-vision-grid">
                    <div class="culture-card prominent-card">
                        <div class="icon"><i class="fas fa-bullseye"></i></div>
                        <h2>Miss√£o</h2>
                        <p>Simplificar o acesso a direitos para quem enfrenta a dor.</p>
                    </div>
                    <div class="culture-card prominent-card">
                        <div class="icon"><i class="fas fa-eye"></i></div>
                        <h2>Vis√£o</h2>
                        <p>Conduzir ao √™xito mais de 100 mil processos at√© 2030.</p>
                    </div>
                </div>
                <div id="values-card" class="culture-card">
                    <div class="icon"><i class="fas fa-star"></i></div>
                    <h2>Nossos Valores</h2>
                    <div class="values-inline-list">
                        <span class="value-tag"><i class="fas fa-balance-scale"></i> √âtica Profissional</span>
                        <span class="value-tag"><i class="fas fa-trophy"></i> Meritocracia</span>
                        <span class="value-tag"><i class="fas fa-lightbulb"></i> Inova√ß√£o</span>
                        <span class="value-tag"><i class="fas fa-heart"></i> Empatia</span>
                        <span class="value-tag"><i class="fas fa-bolt"></i> Proatividade</span>
                        <span class="value-tag"><i class="fas fa-search"></i> Aten√ß√£o aos Detalhes</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="pagamentos-view" class="carousel-page" data-name="Aprovados">
            <div class="header">
                <h1><i class="fas fa-hand-holding-usd"></i> Painel de Aprovados</h1>
                <p class="subtitle">Acompanhamento de processos por status.</p>
                <div class="process-counter-container" style="border-top: none; padding-top: 15px; margin-top: 20px;">
                    <h3 style="font-size: 2.2rem; color: #8b5cf6;">Processos Finalizados Rumo √† Meta</h3>
                    <div class="process-counter" style="font-size: 4.5rem; margin-top: 10px;">
                        <span id="finishedProcesses">20.000</span> / 100.000
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="payment-filter-container">
                    <button class="payment-filter-btn active" onclick="filterPayments('all')"><i class="fas fa-list-ul"></i> Todos</button>
                    <button class="payment-filter-btn" onclick="filterPayments('aprovado')"><i class="fas fa-thumbs-up"></i> Aprovado</button>
                    <button class="payment-filter-btn" onclick="filterPayments('na_conta')"><i class="fas fa-wallet"></i> Na Conta</button>
                    <button class="payment-filter-btn" onclick="filterPayments('pago')"><i class="fas fa-check-double"></i> Pago</button>
                </div>
        
                <div id="section-aprovado" class="payment-status-section">
                    <h2><i class="fas fa-thumbs-up"></i> Processos com Status 'Aprovado'</h2>
                    <table class="sales-table">
                        <thead><tr><th>Data</th><th>Nome</th><th>Processo</th><th>Valor</th></tr></thead>
                        <tbody id="aprovadoTableBody"></tbody>
                    </table>
                </div>
        
                <div id="section-na_conta" class="payment-status-section">
                    <h2><i class="fas fa-wallet"></i> Processos com Status 'Na Conta'</h2>
                    <table class="sales-table">
                        <thead><tr><th>Data</th><th>Nome</th><th>Processo</th><th>Valor</th></tr></thead>
                        <tbody id="naContaTableBody"></tbody>
                    </table>
                </div>
        
                <div id="section-pago" class="payment-status-section">
                    <h2><i class="fas fa-check-double"></i> Processos com Status 'Pago'</h2>
                    <table class="sales-table">
                        <thead><tr><th>Data</th><th>Nome</th><th>Processo</th><th>Valor</th></tr></thead>
                        <tbody id="pagoTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="rtm-pagamentos-view" class="carousel-page" data-name="Pagamentos RTM">
            <div class="header">
                <h1><i class="fas fa-receipt"></i> Pagamentos de RTM</h1>
                <p class="subtitle">Acompanhamento de pagamentos recebidos via RTM.</p>
                <div class="process-counter-container" style="border-top: none; padding-top: 15px; margin-top: 20px;">
                    <h3 style="font-size: 2.2rem; color: #8b5cf6;">RTMs Cobrados Hoje</h3>
                    <div class="process-counter" style="font-size: 4.5rem; margin-top: 10px;">
                        <span id="rtmTodayCounter">0</span>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2 style="border-bottom: none; padding-bottom: 0;"><i class="fas fa-history"></i> Hist√≥rico de Recebimentos</h2>
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Valor</th>
                            <th>Cobrado por</th>
                        </tr>
                    </thead>
                    <tbody id="rtmPaymentsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="acordos-view" class="carousel-page" data-name="Acordos">
            <div class="header">
                <h1><i class="fas fa-handshake"></i> Painel de Acordos</h1>
                <p class="subtitle">Acompanhamento de acordos e negocia√ß√µes.</p>
            </div>
            <div class="panel">
                <h2 style="border-bottom: none; padding-bottom: 0;"><i class="fas fa-tasks"></i> Status dos Acordos</h2>
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Processo</th>
                            <th>Valor</th>
                            <th>Honor√°rios</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="acordosTableBody"></tbody>
                </table>
            </div>
        </div>
    
        <div id="schedule-view" class="carousel-page" data-name="Cronograma">
            <div class="header">
                <h1><i class="fas fa-calendar-alt"></i> Cronograma ReVive</h1>
                <p class="subtitle">Fique por dentro dos nossos pr√≥ximos eventos!</p>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="content">
                        <span class="date">20 de Dezembro de 2025</span>
                        <h3>Evento de Final de Ano - ReVive</h3>
                        <p>O maior evento j√° realizado pela ReVive, com m√∫sica ao vivo, apresenta√ß√£o de resultados e o novidades incr√≠veis.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sale-notification-overlay">
        <div class="notification-content">
            <img id="notification-photo" src="" alt="Foto" class="notification-photo">
            <div id="notification-main-icon" class="main-icon"></div>
            <h2 id="notification-title"></h2>
            <p id="notification-text"></p>
            <div class="process-info" id="notification-secondary-text"></div>
            <div id="animation-extras-container" class="animation-extras"></div>
        </div>
    </div>

    <div id="process-details-modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeProcessDetails()">√ó</span>
            <h2 id="modal-title">Detalhes de Processos</h2>
            <div id="modal-details-content"></div>
        </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // ==================================================================
        // VARI√ÅVEIS GLOBAIS
        // ==================================================================
        let salesData = []; // Armazenar√° dados de SC
        let cearaData = []; // Armazenar√° dados de CE
        let paymentsData = [];
        let rtmPaymentsData = [];
        let acordosData = [];
        let firstLoad = true;
        let isAnimationPlaying = false;
        let carouselPaused = false;
        let notificationQueue = [];
        let currentMonthCounts = {};
        let processEvolutionChartInstance = null;
        let consultantDetails = {};
        let carouselInterval;
        let carouselPages = [];
        let currentPageIndex = 0;

        // ==================================================================
        // CONFIGURA√á√ïES PRINCIPAIS - APONTE PARA AS PLANILHAS CORRETAS
        // ==================================================================
        const FIXED_SHEET_ID = "1YyyXkC2f3PU7_-IsO0ZgyusKVelyweZ301p63XFDrJ8"; // ID da Planilha de Fechamentos
        const SALES_SHEET_GID = "28186636"; // GID da sua aba principal de dados

        // Define os consultores do Cear√° (em min√∫sculo e sem acentos)
        const CEARA_CONSULTANTS = new Set(['weslley', 'sabrina', 'livia', 'vanessa', 'lucas']);

        // IDs das outras planilhas
        // ATEN√á√ÉO: Verifique se o PGTO_SHEET_GID est√° na mesma planilha (FIXED_SHEET_ID) ou em outra.
        // Se estiver em outra, crie uma constante PGTO_SHEET_ID. Por agora, vamos assumir que est√° na mesma.
        const PGTO_SHEET_GID = "1456804198"; // GID da aba de Pagamentos
        const NEW_RTM_SHEET_ID = "1KcEKtzGxSGEICRw14ctfCD4sDsQJuzl3OSwVZQcHSWE";
        const NEW_RTM_SHEET_GID = "485541894";
        const ACORDOS_SHEET_ID = "1kwsL_Gkw-LC-n_E_nLUCzE9CuFtQDhRe";
        const ACORDOS_SHEET_GID = "277487318";
        // ==================================================================

        const DRA_RENATA_STRING = "DRA RENATA";
        const DEFAULT_AVATAR = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NkZGFmYiI+PHBhdGggZD0iTTEyIDJBNCA0IDAgMCAwIDggNkE0IDQgMCAwIDAgMTIgMTBBNCA0IDAgMCAwIDE2IDZBNCA0IDAgMCAwIDEyIDJ6bTAgMTBDOC4xMyAxMiA0IDEzLjc5IDQgMTd2M2g4di0zYzAtMS42NiAxLjM0LTMgMy0zaDEuNjlBMy4wMDIgMy4wMDIgMCAwIDEgMTYgMTRjMS42NiAwIDMgMS4zNCAzIDN2M2gydi0zYzAtMy4yMS00LjEzLTUtOC01eiIvPjwvc3ZnPg==';

        const PREVIDENCIARIO_TYPES = ['CONCESS√ÉO MATERNIDADE', 'AUXILIO-ACIDENTE', 'APOSENTADORIA POR TEMPO DE SERVI√áO', 'LOAS', 'AUXILIO-DOEN√áA', 'APOSENTADORIA POR IDADE', 'APOSENTADORIA POR INVALIDEZ', 'PENS√ÉO POR MORTE'].map(type => type.toUpperCase().trim());
        const SEGURO_TERCEIRO_TYPES = ['TERCEIRO DANO CORPORAL', 'TERCEIRO DANO MATERIAL'].map(type => type.toUpperCase().trim());
        const SEGURO_VIDA_TYPES = ['VIDA', 'VIDA APLICATIVO'].map(type => type.toUpperCase().trim());

        // ==================================================================
        // FUN√á√ïES DO CARROSSEL E ANIMA√á√ïES (RESTAURADAS)
        // ==================================================================
        function setupCarousel() {
            carouselPages = document.querySelectorAll('.carousel-page');
            if (carouselPages.length === 0) return;
            const pageSelector = document.getElementById('pageSelector');
            pageSelector.innerHTML = '';
            carouselPages.forEach((page, index) => {
                const pageName = page.dataset.name || `P√°gina ${index + 1}`;
                const option = document.createElement('option');
                option.value = index;
                option.textContent = pageName;
                pageSelector.appendChild(option);
            });
            startCarouselInterval();
            updatePageSelector();
        }

        function startCarouselInterval() {
            clearInterval(carouselInterval);
            carouselInterval = setInterval(() => {
                if (isAnimationPlaying || carouselPaused) return;
                navigateCarousel(1);
            }, 35000);
        }

        function navigateCarousel(direction) {
            if (carouselPages.length === 0) return;
            carouselPages[currentPageIndex].classList.remove('active');
            currentPageIndex = (currentPageIndex + direction + carouselPages.length) % carouselPages.length;
            carouselPages[currentPageIndex].classList.add('active');
            updatePageSelector();
        }

        function manualNavigate(direction) {
            clearInterval(carouselInterval);
            navigateCarousel(direction);
            if (!carouselPaused) {
                startCarouselInterval();
            }
        }
        
        function jumpToPage(index) {
            clearInterval(carouselInterval);
            carouselPages[currentPageIndex].classList.remove('active');
            currentPageIndex = parseInt(index, 10);
            carouselPages[currentPageIndex].classList.add('active');
            updatePageSelector();
            if (!carouselPaused) {
                startCarouselInterval();
            }
        }

        function updatePageSelector() {
            const pageSelector = document.getElementById('pageSelector');
            if (pageSelector) {
                pageSelector.value = currentPageIndex;
            }
        }
        
        function processNotificationQueue() { /* ... (fun√ß√µes de notifica√ß√£o podem ser adicionadas aqui se necess√°rio) ... */ }
        function triggerSaleAnimation(sale) { /* ... */ }
        function onAnimationFinish() { /* ... */ }

        // ==================================================================
        // FUN√á√ïES DE BUSCA E PROCESSAMENTO DE DADOS (CORRIGIDAS)
        // ==================================================================
        function parseCSVLine(line) {
            const result = []; let current = ''; let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                let char = line[i];
                if (char === '"') {
                    if (inQuotes && i + 1 < line.length && line[i+1] === '"') { current += '"'; i++; } else { inQuotes = !inQuotes; }
                } else if (char === ',' && !inQuotes) {
                    result.push(current); current = '';
                } else { current += char; }
            }
            result.push(current);
            return result.map(item => item.trim());
        }
        
        function parsePtBrDate(dateString) {
            if (!dateString || typeof dateString !== 'string') return null;
            const parts = dateString.split(' ')[0].split('/');
            if (parts.length === 3) {
                const [day, month, year] = parts.map(p => parseInt(p, 10));
                if (!isNaN(day) && !isNaN(month) && !isNaN(year)) {
                    const fullYear = year < 100 ? 2000 + year : year;
                    return new Date(fullYear, month - 1, day);
                }
            }
            const genericDate = new Date(dateString);
            if (!isNaN(genericDate.getTime())) return genericDate;
            return null;
        }

        async function processCsvData(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length < 2) return [];
            const headers = parseCSVLine(lines[0]).map(h => h.trim());
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const columns = parseCSVLine(lines[i]);
                const rowData = { originalIndex: i + 1 };
                headers.forEach((header, index) => {
                    if (header) rowData[header] = (columns[index] || '').trim();
                });
                rowData.Consultor = rowData.Consultor || rowData.consultor;
                if ((rowData['Processo'] || '').toUpperCase() === 'CANCELADO' || !rowData.Consultor) continue;
                data.push(rowData);
            }
            return data;
        }

        function splitDataByRegion(allData) {
            const sc = [];
            const ce = [];
            const cutoffDateSabrina = new Date(2025, 9, 1);
            allData.forEach(sale => {
                const normalizedConsultant = getNormalizedConsultantKey(sale.Consultor);
                if (CEARA_CONSULTANTS.has(normalizedConsultant)) {
                    if (normalizedConsultant === 'sabrina') {
                        const saleDate = parsePtBrDate(sale.Data);
                        if (saleDate && saleDate >= cutoffDateSabrina) {
                            ce.push(sale);
                        } else {
                            sc.push(sale);
                        }
                    } else {
                        ce.push(sale);
                    }
                } else {
                    sc.push(sale);
                }
            });
            salesData = sc;
            cearaData = ce;
        }

        async function fetchMainSalesData() {
            try {
                updateConnectionStatus('loading', 'Conectando √† Planilha...');
                const csvUrl = `https://docs.google.com/spreadsheets/d/${FIXED_SHEET_ID}/export?format=csv&gid=${SALES_SHEET_GID}&_=${new Date().getTime()}`;
                const response = await fetch(csvUrl, { mode: 'cors' });
                if (!response.ok) throw new Error(`Falha na conex√£o: ${response.statusText}`);
                const csvData = await response.text();
                if (csvData && csvData.trim()) {
                    const combinedData = await processCsvData(csvData);
                    splitDataByRegion(combinedData);
                    if (document.getElementById('monthFilter').options.length === 0) {
                        populateMonthFilter(combinedData);
                    }
                    updateDashboard();
                }
            } catch (error) {
                console.error("Erro ao buscar dados de fechamentos:", error);
                updateConnectionStatus('error', 'Falha na conex√£o principal');
            }
        }
        
        async function fetchPaymentsData() {
            try {
                const csvUrl = `https://docs.google.com/spreadsheets/d/${FIXED_SHEET_ID}/export?format=csv&gid=${PGTO_SHEET_GID}&_=${new Date().getTime()}`;
                // ... (restante da fun√ß√£o)
            } catch (error) { /* ... */ }
        }
        async function fetchRtmPaymentsData() { /* ... */ }
        async function fetchAcordosData() { /* ... */ }
        async function processPaymentsCsv(csvText) { /* ... */ }
        async function processRtmCsv(csvText) { /* ... */ }
        async function processAcordosCsv(csvText) { /* ... */ }
        
        async function fetchAllData() {
            await fetchMainSalesData();
            await Promise.allSettled([
                // fetchPaymentsData(), // Descomente se a aba de pagamentos estiver na mesma planilha
                fetchRtmPaymentsData(),
                fetchAcordosData() 
            ]);
            // updateTotalFinishedCounter();
            updateConnectionStatus('connected', 'Conectado');
            firstLoad = false;
        }

        // ==================================================================
        // FUN√á√ïES DE CONTAGEM E RANKING (CORRIGIDAS)
        // ==================================================================
        function countTotalProcesses(sales) {
            const PROCESS_MAP_AUDIT = { 'DPVAT': 'DPVAT', 'Vida': 'VIDA', 'Terceiro': 'TERCEIRO', 'A√ß√£o de Acidente de Tr√¢nsito': 'AAT', 'Aux√≠lio-Doen√ßa': 'AUX_DOENCA', 'Aux√≠lio-Acidente': 'AUX_ACIDENTE', 'Aux√≠lio-Maternidade': 'AUX_MATERNIDADE', 'Aposentadoria': 'APOSENTADORIA', 'LOAS': 'LOAS', 'Outros Processos': 'OUTROS' };
            const PROCESSOS_MULTIPLOS = { 'Vida': 3, 'Aposentadoria': 3, 'Aux√≠lio-Maternidade': 5 };
            let totalValido = 0;
            sales.forEach(sale => {
                for (const nomeProcesso in PROCESS_MAP_AUDIT) {
                    const chaveBase = PROCESS_MAP_AUDIT[nomeProcesso];
                    if (PROCESSOS_MULTIPLOS[nomeProcesso]) {
                        for (let i = 1; i <= PROCESSOS_MULTIPLOS[nomeProcesso]; i++) {
                            const nomeColuna = i === 1 ? nomeProcesso : `${nomeProcesso}_${i}`;
                            if (sale[nomeColuna] === 'SIM') {
                                if (sale[`${chaveBase}_${i}_STATUS`] !== 'ARQUIVADO') totalValido++;
                            }
                        }
                    } else {
                        if (sale[nomeProcesso] === 'SIM') {
                            if (sale[`${chaveBase}_STATUS`] !== 'ARQUIVADO') totalValido++;
                        }
                    }
                }
            });
            return totalValido;
        }

        function updateConsultantRanking(monthSales, rankingElementId, topConsultantId = null, topPhotoId = null) {
            const PROCESS_MAP_AUDIT = { 'DPVAT': 'DPVAT', 'Vida': 'VIDA', 'Terceiro': 'TERCEIRO', 'A√ß√£o de Acidente de Tr√¢nsito': 'AAT', 'Aux√≠lio-Doen√ßa': 'AUX_DOENCA', 'Aux√≠lio-Acidente': 'AUX_ACIDENTE', 'Aux√≠lio-Maternidade': 'AUX_MATERNIDADE', 'Aposentadoria': 'APOSENTADORIA', 'LOAS': 'LOAS', 'Outros Processos': 'OUTROS' };
            const PROCESSOS_MULTIPLOS = { 'Vida': 3, 'Aposentadoria': 3, 'Aux√≠lio-Maternidade': 5 };
            const stats = {};
            monthSales.forEach(sale => {
                if (!sale.Consultor) return;
                const key = getNormalizedConsultantKey(sale.Consultor);
                if (!stats[key]) {
                    const displayName = sale.Consultor.trim().split(' ')[0];
                    stats[key] = { name: displayName.charAt(0).toUpperCase() + displayName.slice(1).toLowerCase(), sales: 0, processDetails: {} };
                }
                let processosValidos = 0;
                for (const nomeProcesso in PROCESS_MAP_AUDIT) {
                    const chaveBase = PROCESS_MAP_AUDIT[nomeProcesso];
                    if (PROCESSOS_MULTIPLOS[nomeProcesso]) {
                        for (let i = 1; i <= PROCESSOS_MULTIPLOS[nomeProcesso]; i++) {
                            const nomeColuna = i === 1 ? nomeProcesso : `${nomeProcesso}_${i}`;
                            const nomeColunaAlt = `${nomeProcesso}_${i}`;
                            if (sale[nomeColuna] === 'SIM' || sale[nomeColunaAlt] === 'SIM') {
                                if (sale[`${chaveBase}_${i}_STATUS`] !== 'ARQUIVADO') {
                                    processosValidos++;
                                    stats[key].processDetails[nomeProcesso] = (stats[key].processDetails[nomeProcesso] || 0) + 1;
                                }
                            }
                        }
                    } else {
                        if (sale[nomeProcesso] === 'SIM') {
                            if (sale[`${chaveBase}_STATUS`] !== 'ARQUIVADO') {
                                processosValidos++;
                                stats[key].processDetails[nomeProcesso] = (stats[key].processDetails[nomeProcesso] || 0) + 1;
                            }
                        }
                    }
                }
                stats[key].sales += processosValidos;
            });
            consultantDetails = { ...consultantDetails, ...stats };
            const ranking = Object.values(stats).sort((a, b) => b.sales - a.sales);
            if (topConsultantId && topPhotoId) {
                const topNameEl = document.getElementById(topConsultantId);
                const topPhotoEl = document.getElementById(topPhotoId);
                if (ranking.length > 0 && ranking[0].sales > 0) {
                    const top = ranking[0];
                    topNameEl.textContent = top.name;
                    topPhotoEl.src = getConsultantPhotoUrl(top.name);
                    topPhotoEl.onerror = () => { topPhotoEl.src = DEFAULT_AVATAR; topPhotoEl.onerror = null; };
                    topPhotoEl.style.display = 'inline-block';
                } else {
                    topNameEl.textContent = '-';
                    topPhotoEl.style.display = 'none';
                }
            }
            const rankNumClass = rankingElementId === 'cearaRanking' ? 'rank-number rank-number-ce' : 'rank-number';
            const stateSuffix = rankingElementId === 'cearaRanking' ? 'CE' : 'SC';
            let listHtml = '';
            ranking.forEach((c, i) => {
                const photoUrl = getConsultantPhotoUrl(c.name);
                const consultantKey = getNormalizedConsultantKey(c.name);
                listHtml += `<div class="ranking-item"><div class="consultant-info"><div class="${rankNumClass}">${i + 1}</div><img src="${photoUrl}" class="consultant-photo-ranking" onerror="this.src='${DEFAULT_AVATAR}'; this.onerror=null;"><div class="consultant-name">${c.name}</div></div><div class="sales-count" onclick="showProcessDetails('${consultantKey}')">${c.sales}</div></div>`;
            });
            let finalHtml = `<div id="ranking-list-${stateSuffix}" class="ranking-list-container ${ranking.length > 5 ? 'collapsed' : ''}">${listHtml}</div>`;
            if (ranking.length > 5) {
                const btnClass = stateSuffix === 'CE' ? 'expand-ranking-btn btn-ce' : 'expand-ranking-btn';
                finalHtml += `<button id="expand-btn-${stateSuffix}" class="${btnClass}" onclick="toggleRanking('${stateSuffix}')">Ver Ranking Completo</button>`;
            }
            const container = document.getElementById(rankingElementId);
            if (container) {
                container.innerHTML = finalHtml || '<p style="text-align:center;color:#6b7280;padding:20px;">Nenhum processo v√°lido para o m√™s.</p>';
            }
        }
        
        // ==================================================================
        // FUN√á√ïES DE ATUALIZA√á√ÉO DA INTERFACE (UI)
        // ==================================================================
        function getNormalizedConsultantKey(fullName) {
            if (!fullName || typeof fullName !== 'string') return 'desconhecido';
            return fullName.trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().split(' ')[0];
        }

        function getConsultantPhotoUrl(consultantName) {
            if (!consultantName) return DEFAULT_AVATAR;
            const baseName = getNormalizedConsultantKey(consultantName);
            return `${baseName}.PNG`;
        }

        function getMonthSales() {
            const selected = document.getElementById('monthFilter').value;
            if (!selected) return [];
            const [month, year] = selected.split('/').map(Number);
            return salesData.filter(sale => {
                const date = parsePtBrDate(sale.Data);
                return date && date.getMonth() + 1 === month && date.getFullYear() === year;
            });
        }
        
        function getMonthCeara() {
            const selected = document.getElementById('monthFilter').value;
            if (!selected) return [];
            const [month, year] = selected.split('/').map(Number);
            return cearaData.filter(sale => {
                const date = parsePtBrDate(sale.Data);
                return date && date.getMonth() + 1 === month && date.getFullYear() === year;
            });
        }

        function updateDashboard() {
            if (document.getElementById('monthFilter').options.length === 0) return;
            const monthSalesSC = getMonthSales();
            const monthSalesCE = getMonthCeara();
            const totalSC = countTotalProcesses(monthSalesSC);
            const totalCE = countTotalProcesses(monthSalesCE);
            updateMainStats(totalSC, totalCE, monthSalesSC, monthSalesCE);
            updateProcessStats(monthSalesSC, monthSalesCE); 
            updateConsultantRanking(monthSalesSC, 'consultantRanking', 'topConsultant', 'topConsultantPhoto');
            updateConsultantRanking(monthSalesCE, 'cearaRanking', 'topConsultantCE', 'topConsultantPhotoCE');
            populateConsultantFilter(monthSalesSC, 'consultantFilter', filterSalesByConsultant);
            populateConsultantFilter(monthSalesCE, 'consultantFilterCE', filterSalesByConsultantCE);
            updateMonthSales(monthSalesSC, 'consultantFilter', 'recentSalesTable');
            updateMonthSales(monthSalesCE, 'consultantFilterCE', 'recentSalesTableCE');
            // updateProcessEvolutionChart(salesData, cearaData);
        }

        function updateMainStats(totalSC, totalCE, monthSalesSC, monthSalesCE) {
            document.getElementById('totalMonthGlobal').textContent = totalSC + totalCE;
            document.getElementById('totalMonthSC').textContent = totalSC;
            document.getElementById('totalMonthCE').textContent = totalCE;
            const selected = document.getElementById('monthFilter').value;
            if (selected) {
                const [month, year] = selected.split('/');
                const names = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const label = `${names[parseInt(month, 10) - 1]} ${year}`;
                document.getElementById('monthLabelGlobal').textContent = label;
                document.getElementById('monthLabelSC').textContent = label;
            }
            const maxDaySC = monthSalesSC.reduce((max, sale) => { const d = parsePtBrDate(sale.Data); return d ? Math.max(max, d.getDate()) : max; }, 0);
            document.getElementById('dailyAverageSC').textContent = (totalSC > 0 && maxDaySC > 0 ? (totalSC / maxDaySC) : 0).toFixed(1);
            const maxDayCE = monthSalesCE.reduce((max, sale) => { const d = parsePtBrDate(sale.Data); return d ? Math.max(max, d.getDate()) : max; }, 0);
            document.getElementById('dailyAverageCE').textContent = (totalCE > 0 && maxDayCE > 0 ? (totalCE / maxDayCE) : 0).toFixed(1);
        }

        function updateProcessStats(monthSales, monthCeara) { /* ... (pode ser implementado com a nova l√≥gica de colunas) ... */ }
        
        function populateConsultantFilter(monthSales, filterId, onChangeFunction) {
            const select = document.getElementById(filterId);
            if (!select) return;
            const current = select.value;
            const map = new Map();
            monthSales.forEach(sale => {
                if (sale.Consultor && sale.Consultor.trim() !== "") {
                    const key = getNormalizedConsultantKey(sale.Consultor);
                    if (!map.has(key)) {
                        const name = sale.Consultor.trim().split(' ')[0];
                        map.set(key, name.charAt(0).toUpperCase() + name.slice(1).toLowerCase());
                    }
                }
            });
            const sorted = Array.from(map.entries()).sort((a, b) => a[1].localeCompare(b[1]));
            select.innerHTML = '<option value="all">Todos</option>';
            sorted.forEach(([key, name]) => select.add(new Option(name, key)));
            if (Array.from(select.options).some(opt => opt.value === current)) select.value = current;
            select.onchange = onChangeFunction;
        }

        function filterSalesByConsultant() { updateMonthSales(getMonthSales(), 'consultantFilter', 'recentSalesTable'); }
        function filterSalesByConsultantCE() { updateMonthSales(getMonthCeara(), 'consultantFilterCE', 'recentSalesTableCE'); }

        function updateMonthSales(sales, filterId, tableId) {
            const select = document.getElementById(filterId);
            const key = select ? select.value : 'all';
            let filtered = sales;
            if (key !== 'all') {
                filtered = sales.filter(s => s.Consultor && getNormalizedConsultantKey(s.Consultor) === key);
            }
            const sorted = [...filtered].sort((a, b) => (parsePtBrDate(b.Data) - parsePtBrDate(a.Data)) || b.originalIndex - a.originalIndex);
            let html = '';
            sorted.forEach(s => {
                html += `<tr><td><span class="date-badge">${s.Data || '-'}</span></td><td>${s['Nome do Cliente'] || '-'}</td><td><span class="process-badge">${s.Processo || '-'}</span></td><td>${s.Consultor || '-'}</td></tr>`;
            });
            document.getElementById(tableId).innerHTML = html || '<tr><td colspan="4" style="text-align:center;padding:20px;color:#6b7280;">Nenhum processo encontrado.</td></tr>';
        }

        function populateMonthFilter(allData) {
            const monthSet = new Set();
            allData.forEach(sale => {
                if (sale.Data) {
                    const date = parsePtBrDate(sale.Data);
                    if (date) monthSet.add(`${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`);
                }
            });
            const select = document.getElementById('monthFilter');
            const current = select.value;
            const allMonths = Array.from(monthSet).sort((a, b) => {
                const [ma, ya] = a.split('/'); const [mb, yb] = b.split('/');
                return new Date(yb, mb - 1) - new Date(ya, ma - 1);
            });
            select.innerHTML = '';
            allMonths.forEach(m => select.add(new Option(m, m)));
            if (allMonths.includes(current)) select.value = current;
            else if (allMonths.length > 0) select.value = allMonths[0];
        }

        function showProcessDetails(consultantKey) { /* ... */ }
        function closeProcessDetails() { /* ... */ }
        function filterPayments(status) { /* ... */ }
        function toggleRanking(stateSuffix) {
            const list = document.getElementById(`ranking-list-${stateSuffix}`);
            const button = document.getElementById(`expand-btn-${stateSuffix}`);
            if (list && button) {
                list.classList.toggle('collapsed');
                button.textContent = list.classList.contains('collapsed') ? 'Ver Ranking Completo' : 'Mostrar Menos';
            }
        }
        
        // ==================================================================
        // INICIALIZA√á√ÉO
        // ==================================================================
        document.addEventListener('DOMContentLoaded', function() {
            setupCarousel(); // <-- CHAMADA RESTAURADA
            fetchAllData(); 
            setInterval(fetchAllData, 30000);

            const modal = document.getElementById('process-details-modal');
            window.onclick = function(event) { if (event.target == modal) closeProcessDetails(); }

            const toggleBtn = document.getElementById('carousel-toggle-button');
            const icon = toggleBtn.querySelector('i');
            toggleBtn.addEventListener('click', () => {
                carouselPaused = !carouselPaused;
                if (carouselPaused) {
                    icon.className = 'fas fa-play';
                    toggleBtn.title = 'Retomar Carrossel';
                    clearInterval(carouselInterval);
                } else {
                    icon.className = 'fas fa-pause';
                    toggleBtn.title = 'Pausar Carrossel';
                    startCarouselInterval();
                }
            });
            // filterPayments('all'); // Descomentado se a aba de pagamentos for usada
        });
    </script>
</body>
</html>
